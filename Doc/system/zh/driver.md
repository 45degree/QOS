# 硬盘驱动

## 硬件链接与传输方式

硬盘控制器和硬盘本身使用的接口标准是ATA-8。一块普通的PC主板一般提供2个IDE通道(Primary和Secondary),
它们有时也被标注为IDE0和IDE1, 一个IDE通道能够连接2个设备, 分别称为主设备(Master)和从设备(Slave)。
**事实上一个机器不只允许有两个IDE通道，但超过两个的情况非常罕见, 所以代码实现中不考虑此情况。**

硬盘的传输方式采用PIO模式(DAM模式会在以后支持)。

## 硬盘设备号

设备号分为主设备号和次设备号

### 主设备号

主设备号的作用是区别不同设备对应的驱动程序, 例如0代表硬盘驱动程序, 1代表软盘驱动程序

### 次设备号

次设备号主要是用来区分磁盘上的不同分区。

一张硬盘的分区结构如下图所示, 一张硬盘最多有4个主分区和扩展分区, 每个分区中又可以有16个逻辑分区,
用`hd0`表示IDE0上硬盘, `hd1`~`hd4`分别表示该硬盘上的4个主分区和扩展分区,`hd1a`~`hd1p`、`hd2a`~`hd2p`、
`hd3a`~`hd3p`、`hd4a`~`hd4p`表示`hd1`、`hd2`、`hd3`、`hd4`的逻辑分区。所以, 0即为硬盘`hd0`的次设备号,
1、2、3、4为`hd1`、`hd2`、`hd3`和`hd4`的次设备号，以此类推。

``` txt
+-----------------------------------------------------+
|                        hd0                          | <-- disk
+--------------------------+--------------------------+
|          hd1             |             hd2          | <-- primary and extended partition
+------+------+-----+-------------+------+-----+------+
| hd1a | hd1b | ... | hd1p | hd2a | hd2b | ... | hd2p | <-- logical partition
+------+------+-----+------+------+------+-----+------+

+-----------------------------------------------------+
|                        hd0                          | <-- disk
+--------------------------+--------------------------+
|           hd3            |           hd4            | <-- primary and extended partition
+------+------+-----+-------------+------+-----+------+
| hd3c | hd3c | ... | hd3p | hd4a | hd4b | ... | hb4p | <-- logical partition
+------+------+-----+------+------+------+-----+------+
```

次设备号的存储用一个16位的数表示, 其中高8位表示该分区所属的主分区或扩展分区, 低8位表示该分区所在的
逻辑分区中的位置。例如, `hd1a`的次设备号是1a, 则对应的16位数为257, 其低8位和高8位都是1, 说明其在`hd1`的
第一个逻辑分区。
